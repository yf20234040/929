# 历小包小程序 - 关键代码位置及功能说明

## 项目结构概览

```
历小包/
├── pages/                    # 页面文件
│   ├── index/               # 首页相关
│   ├── login/               # 登录相关
│   ├── issue1/              # 第一期内容
│   ├── issue2/              # 第二期内容
│   ├── issue3/              # 第三期内容
│   └── profile/             # 个人中心
├── components/              # 组件文件
├── utils/                   # 工具类
├── server/                  # 后端服务
├── static/                  # 静态资源
└── config/                  # 配置文件
```

## 核心功能模块

### 1. 工具箱功能（暂时禁用AI功能）
**文件位置：** `pages/index/AiTab.vue`
**功能说明：**
- 智能问答功能正在开发中
- 显示功能预告和占位内容
- 提供用户友好的等待体验
- 包含功能预告列表和联系信息

**当前状态：**
```javascript
// AI功能暂时注释，显示占位内容
// 用户点击工具箱按钮时显示"功能预告"弹窗
showComingSoon() {
  uni.showModal({
    title: '功能预告',
    content: '智能问答功能正在开发中，敬请期待！',
    showCancel: false,
    confirmText: '知道了'
  })
}
```

### 2. 微信登录功能
**文件位置：** `components/WechatLogin.vue`
**功能说明：**
- 微信手机号一键登录
- 支持授权获取用户手机号
- 自动保存登录状态
- 登录成功后跳转个人中心

**关键代码：**
```javascript
// 获取手机号授权
<button 
  open-type="getPhoneNumber" 
  @getphonenumber="handleGetPhoneNumber"
  class="login-btn wechat-btn"
>
  手机号快捷登录
</button>

// 处理授权回调
async handleGetPhoneNumber(e) {
  if (e.detail.errMsg !== 'getPhoneNumber:ok') {
    uni.showToast({ title: '用户取消授权或获取失败', icon: 'none' });
    return;
  }
  // 调用后端API获取手机号
  const phoneResult = await this.getPhoneNumberFromServer(e.detail.code);
}
```

### 3. 后端API服务
**文件位置：** `server/wechat-auth.js`
**功能说明：**
- 处理微信登录认证
- 获取用户手机号
- 生成JWT token
- 用户信息管理

**关键代码：**
```javascript
// 微信小程序配置
const WECHAT_MP_CONFIG = {
  appId: 'wx26ff9c276f816bd8',
  appSecret: '79ede02ae7b0abb69fd66fb0ef06e134'
};

// 手机号登录接口
router.post('/get-phone-number', async (req, res) => {
  const { code } = req.body;
  const accessToken = await getWechatAccessToken();
  const phoneNumber = await getPhoneNumber(accessToken, code);
  const user = findOrCreateUser(phoneNumber);
  const token = generateToken(user);
  
  res.json({
    success: true,
    message: '登录成功',
    data: { token, userInfo: user }
  });
});
```

### 4. 首页导航
**文件位置：** `pages/index/index.vue`
**功能说明：**
- 底部自定义导航栏
- 支持首页、实践、AI助手、团队、个人中心
- AI按钮居中显示，圆形Logo设计

**关键代码：**
```javascript
// AI按钮跳转
navigateToAiPage() {
  uni.navigateTo({
    url: '/pages/index/AiTab',
    fail: (err) => {
      console.error('跳转AI页面失败:', err);
      uni.showToast({ title: '页面不存在', icon: 'none' });
    }
  });
}
```

### 5. 个人中心
**文件位置：** `pages/index/ProfileTab.vue`
**功能说明：**
- 显示用户登录状态
- 未登录时显示登录入口
- 已登录时显示用户信息和功能菜单
- 支持退出登录

**关键代码：**
```javascript
// 检查登录状态
checkLoginStatus() {
  const userInfo = uni.getStorageSync('userInfo');
  const isLoggedIn = uni.getStorageSync('isLoggedIn');
  this.isLoggedIn = isLoggedIn === true || isLoggedIn === 'true';
  this.userInfo = userInfo || {};
}
```

### 6. 内容展示模块
**文件位置：** 
- `pages/issue1/` - 第一期内容
- `pages/issue2/` - 第二期内容  
- `pages/issue3/` - 第三期内容

**功能说明：**
- 展示项目各期内容
- 支持图片、视频、文档预览
- 甘特图项目进度展示

**关键文件：**
- `pages/issue3/issue367.vue` - 甘特图工具
- `pages/issue1/issue151-155.vue` - 媒体内容展示

### 7. 配置文件
**文件位置：** `utils/config.js`
**功能说明：**
- 前端API配置
- 微信小程序配置
- 应用基础信息

**关键配置：**
```javascript
export default {
  baseUrl: 'https://llzmlxb.xyz/api',
  wechat: {
    appId: 'wx26ff9c276f816bd8'
  },
  app: {
    name: '历小包',
    version: '1.0.0'
  }
};
```

### 8. 路由配置
**文件位置：** `pages.json`
**功能说明：**
- 页面路由配置
- 导航栏样式设置
- 分包配置

**关键配置：**
```json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "历小包",
        "navigationStyle": "custom"
      }
    },
    {
      "path": "pages/index/AiTab",
      "style": {
        "navigationBarTitleText": "历小包智能AI助手",
        "navigationStyle": "custom"
      }
    }
  ]
}
```

## 技术栈

- **前端框架：** uni-app (Vue.js)
- **UI组件：** 自定义组件
- **后端服务：** Node.js + Express
- **数据库：** MySQL
- **AI服务：** 阿里云DashScope
- **云存储：** 阿里云OSS
- **部署：** 云服务器 + HTTPS

## 主要特性

1. **AI智能问答** - 集成阿里云AI服务
2. **微信一键登录** - 手机号授权登录
3. **多媒体展示** - 图片、视频、文档预览
4. **项目进度管理** - 甘特图展示
5. **响应式设计** - 适配不同设备
6. **离线缓存** - 本地存储用户信息

## 部署说明

1. **前端部署：** 微信开发者工具上传代码
2. **后端部署：** 云服务器运行Node.js服务
3. **域名配置：** 微信小程序后台配置合法域名
4. **HTTPS证书：** 服务器配置SSL证书
