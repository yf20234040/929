{"version":3,"sources":["webpack:///C:/Users/Administrator/Desktop/lxb/components/WechatLogin.vue?8a13","webpack:///C:/Users/Administrator/Desktop/lxb/components/WechatLogin.vue?adb7","webpack:///C:/Users/Administrator/Desktop/lxb/components/WechatLogin.vue?fc99","webpack:///C:/Users/Administrator/Desktop/lxb/components/WechatLogin.vue?3438","uni-app:///components/WechatLogin.vue","webpack:///C:/Users/Administrator/Desktop/lxb/components/WechatLogin.vue?84e0","webpack:///C:/Users/Administrator/Desktop/lxb/components/WechatLogin.vue?c249"],"names":["name","data","loading","methods","handleGetPhoneNumber","e","uni","title","icon","mask","phoneResult","userInfo","nickName","phone","avatarUrl","loginType","timestamp","duration","console","getPhoneNumberFromServer","response","success","phoneNumber","message","callBackendAPI","url","method","code","header","timeout","errorMsg","saveLoginInfo","navigateToProfile","setTimeout"],"mappings":"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","file":"components/WechatLogin.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./WechatLogin.vue?vue&type=template&id=22327458&scoped=true&\"\nvar renderjs\nimport script from \"./WechatLogin.vue?vue&type=script&lang=js&\"\nexport * from \"./WechatLogin.vue?vue&type=script&lang=js&\"\nimport style0 from \"./WechatLogin.vue?vue&type=style&index=0&id=22327458&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"22327458\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/WechatLogin.vue\"\nexport default component.exports","export * from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./WechatLogin.vue?vue&type=template&id=22327458&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./WechatLogin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./WechatLogin.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"wechat-login-container\">\n    <!-- 授权获取手机号按钮 -->\n    <button \n      open-type=\"getPhoneNumber\" \n      @getphonenumber=\"handleGetPhoneNumber\"\n      class=\"login-btn\"\n      :loading=\"loading\"\n      :disabled=\"loading\"\n    >\n      {{ loading ? '登录中...' : '立即登录' }}\n    </button>\n  </view>\n</template>\n\n<script>\nexport default {\n  name: 'WechatLogin',\n  data() {\n    return {\n      loading: false\n    }\n  },\n  methods: {\n    // 获取手机号按钮回调\n    async handleGetPhoneNumber(e) {\n      if (this.loading) return;\n      this.loading = true;\n\n      try {\n        // 检查授权结果\n        if (e.detail.errMsg !== 'getPhoneNumber:ok') {\n          uni.showToast({ title: '获取手机号失败，请重试', icon: 'none' });\n          return;\n        }\n\n        if (!e.detail.code) {\n          uni.showToast({ title: '获取手机号失败，请重试', icon: 'none' });\n          return;\n        }\n\n        uni.showLoading({ title: '登录中...', mask: true });\n\n        try {\n          // 尝试调用后端接口获取手机号\n          const phoneResult = await this.getPhoneNumberFromServer(e.detail.code);\n\n          if (!phoneResult.success) {\n            throw new Error(phoneResult.message || '获取手机号失败');\n          }\n\n          // 构建用户信息\n          const userInfo = {\n            nickName: phoneResult.phoneNumber || '访客用户',\n            phone: phoneResult.phoneNumber,\n            avatarUrl: '',\n            loginType: 'wechatPhone',\n            timestamp: Date.now()\n          };\n\n          // 保存登录信息到本地\n          this.saveLoginInfo(userInfo, e.detail.code);\n\n          uni.hideLoading();\n          uni.showToast({ title: '登录成功', icon: 'success', duration: 1500 });\n\n          this.$emit('login-success', userInfo);\n          this.navigateToProfile();\n\n        } catch (apiError) {\n          console.error('API登录失败，尝试备用方案:', apiError);\n          \n          // 备用方案：直接使用访客模式登录\n          const userInfo = {\n            nickName: '访客用户',\n            phone: '',\n            avatarUrl: '',\n            loginType: 'guest',\n            timestamp: Date.now()\n          };\n\n          // 保存登录信息到本地\n          this.saveLoginInfo(userInfo, e.detail.code);\n\n          uni.hideLoading();\n          uni.showToast({ \n            title: '登录成功（访客模式）', \n            icon: 'success', \n            duration: 2000 \n          });\n\n          this.$emit('login-success', userInfo);\n          this.navigateToProfile();\n        }\n\n      } catch (error) {\n        uni.hideLoading();\n        uni.showToast({ title: error.message || '登录失败，请重试', icon: 'none' });\n        this.$emit('login-error', error);\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    // 调用后端接口获取手机号\n    async getPhoneNumberFromServer(code) {\n      try {\n        const response = await this.callBackendAPI(code);\n\n        if (response.success) {\n          return {\n            success: true,\n            phoneNumber: response.phoneNumber,\n            message: '获取手机号成功'\n          };\n        } else {\n          throw new Error(response.message || '获取手机号失败');\n        }\n      } catch (error) {\n        console.error('获取手机号失败:', error);\n        throw new Error('网络请求失败');\n      }\n    },\n\n    // 调用后端 API\n    async callBackendAPI(code) {\n      try {\n        console.log('开始调用登录API，code:', code);\n        \n        // 使用阿里云服务器地址\n        const response = await uni.request({\n          url: 'https://llzmlxb.xyz/api/auth/get-phone-number',\n          method: 'POST',\n          data: { code },\n          header: { 'Content-Type': 'application/json' },\n          timeout: 10000\n        });\n\n        console.log('API响应:', response);\n        console.log('API响应数据:', response.data);\n\n        if (response && response.statusCode === 200) {\n          if (response.data && response.data.code === 0) {\n            return {\n              success: true,\n              phoneNumber: response.data.data.userInfo.phoneNumber,\n              message: response.data.message\n            };\n          } else {\n            const errorMsg = response.data?.message || '获取手机号失败';\n            console.error('API返回错误:', errorMsg, response);\n            throw new Error(errorMsg);\n          }\n        } else {\n          const errorMsg = response?.errMsg || '网络请求失败';\n          console.error('API请求失败:', errorMsg, response);\n          throw new Error(errorMsg);\n        }\n      } catch (error) {\n        console.error('API调用失败:', error);\n        // 如果是网络错误，提供更友好的提示\n        if (error.errMsg && error.errMsg.includes('timeout')) {\n          throw new Error('网络超时，请检查网络连接');\n        } else if (error.errMsg && error.errMsg.includes('fail')) {\n          throw new Error('网络请求失败，请检查网络连接');\n        }\n        throw error;\n      }\n    },\n\n    // 保存登录信息\n    saveLoginInfo(userInfo, code) {\n      try {\n        uni.removeStorageSync('userInfo');\n        uni.removeStorageSync('wechatPhoneCode');\n        uni.removeStorageSync('loginType');\n        uni.removeStorageSync('isLoggedIn');\n\n        uni.setStorageSync('userInfo', userInfo);\n        uni.setStorageSync('wechatPhoneCode', code);\n        uni.setStorageSync('loginType', 'wechatPhone');\n        uni.setStorageSync('isLoggedIn', true);\n      } catch (error) {\n        console.error('保存登录信息失败:', error);\n      }\n    },\n\n    // 跳转个人中心\n    navigateToProfile() {\n      setTimeout(() => {\n        uni.reLaunch({ url: '/pages/index/index?tab=4' });\n      }, 1500);\n    }\n  }\n}\n</script>\n\n<style scoped>\n.wechat-login-container {\n  padding: 0;\n  width: 100%;\n}\n\n.login-btn {\n  width: 100%;\n  height: 100rpx;\n  background: linear-gradient(135deg, #667eea, #764ba2);\n  color: #ffffff;\n  border-radius: 50rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s ease;\n  box-shadow: 0 8rpx 20rpx rgba(102, 126, 234, 0.3);\n  position: relative;\n  overflow: hidden;\n}\n\n.login-btn::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n  transition: left 0.5s;\n}\n\n.login-btn:active::before {\n  left: 100%;\n}\n\n.login-btn::after {\n  border: none;\n}\n\n.login-btn:disabled {\n  background: #ccc;\n  box-shadow: none;\n  opacity: 0.6;\n}\n\n.login-btn:active {\n  transform: scale(0.98);\n  box-shadow: 0 4rpx 12rpx rgba(102, 126, 234, 0.4);\n}\n</style>\n\n","import mod from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./WechatLogin.vue?vue&type=style&index=0&id=22327458&scoped=true&lang=css&\"; export default mod; export * from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./WechatLogin.vue?vue&type=style&index=0&id=22327458&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1759131437671\n      var cssReload = require(\"D:/Hbuilder X/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}