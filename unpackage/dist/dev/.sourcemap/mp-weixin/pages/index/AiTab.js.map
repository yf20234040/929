{"version":3,"sources":[null,"webpack:///C:/Users/Administrator/Desktop/lxb/pages/index/AiTab.vue?b6d0","webpack:///C:/Users/Administrator/Desktop/lxb/pages/index/AiTab.vue?823c","webpack:///C:/Users/Administrator/Desktop/lxb/pages/index/AiTab.vue?c625","uni-app:///pages/index/AiTab.vue","webpack:///C:/Users/Administrator/Desktop/lxb/pages/index/AiTab.vue?d324","webpack:///C:/Users/Administrator/Desktop/lxb/pages/index/AiTab.vue?c40a","uni-app:///main.js"],"names":["mixins","data","statusBarHeight","inputMessage","messages","isLoading","scrollTop","faqList","question","answer","btnX","btnY","startX","startY","windowWidth","windowHeight","isDragging","onLoad","methods","formatMessage","replace","goBack","console","uni","title","icon","duration","delta","animationType","animationDuration","success","fail","url","clearChat","content","sendMessage","userMessage","role","timestamp","conversationHistory","filter","map","method","timeout","response","askQuestion","loadFaqList","scrollToBottom","formatTime","handleRefresh","mask","handleTouchStart","handleTouchMove","newBtnX","newBtnY","handleTouchEnd","wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACqC;;;AAGzF;AACiL;AACjL,gBAAgB,0LAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAA2pB,CAAgB,grBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACmG/qB;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAEA;EACAA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC,UACA;QACAC;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,GACA;QACAD;QACAC;MACA,EACA;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACA;IACA;;IAEA;IACA;IACA;IACA;IACA;EACA;EACAC;IACA;IACAC;MACA;;MAEA;MACA;MACA;MAAA,CACAC;QACA;QACA;QACA;MACA;MACA;MAAA,CACAA;MACA;MAAA,CACAA;MACA;MAAA,CACAA;MACA;MAAA,CACAA;MACA;MAAA,CACAA;MACA;MAAA,CACAA;MACA;MAAA,CACAA;MAEA;IACA;IAEA;IACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MAEA;QACA;QACA;QACAJ;QACAA;QAEA;UACAA;UACAC;YACAI;YACAC;YACAC;YACAC;cACAR;YACA;YACAS;cACAT;cACA;cACAC;gBACAS;cACA;YACA;UACA;QACA;UACAV;UACA;UACAC;YACAS;YACAF;cACAR;YACA;YACAS;cACAT;YACA;UACA;QACA;MACA;QACAA;QACA;QACAC;UACAS;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACAV;QACAC;QACAU;QACAJ;UACA;YACA;YACA;UACA;QACA;MACA;IACA;IAEA;IACAK;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAEAC;gBACA;;gBAEA;gBACA;kBACAC;kBACAH;kBACAI;gBACA;gBAEA;gBACA;gBAAA;gBAGA;gBACAC,sCACAC;kBAAA;gBAAA,GACAC;kBAAA;oBACAJ;oBACAH;kBACA;gBAAA,IAEA;gBAAA;gBAAA,OACAX;kBACAS;kBACAU;kBACAzC;oBACAO;oBACA+B;kBACA;kBACAI;gBACA;cAAA;gBARAC;gBAAA,MAUAA;kBAAA;kBAAA;gBAAA;gBACA;gBACA;kBACAP;kBACAH;kBACAI;gBACA;gBAAA;gBAAA;cAAA;gBAAA,MAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAIAhB;gBACA;kBACAe;kBACAH;kBACAI;gBACA;cAAA;gBAAA;gBAEA;gBACA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAO;MACA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEAvB;kBACAS;kBACAU;gBACA;cAAA;gBAHAE;gBAKA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAtB;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAyB;MAAA;MACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MAEA;QAAA;QACA;MACA;QAAA;QACA;MACA;QAAA;QACA;MACA;QACA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,KAEA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAEA;gBACA1B;kBACAC;kBACA0B;gBACA;gBAAA;gBAGA;gBACA;gBACA;gBAAA;gBAAA,OACA;cAAA;gBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA5B;gBACAC;kBACAC;kBACAC;kBACAC;gBACA;cAAA;gBAAA;gBAEA;gBACAH;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACA4B;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;QACA;;QAEA;QACA;QACA;;QAEA;QACA;QACA;;QAEA;QACAC;QACAC;;QAEA;QACA;QACA;;QAEA;QACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MAEA;QACA;QACA;MACA;QACA;QACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC9bA;AAAA;AAAA;AAAA;AAA69B,CAAgB,u9BAAG,EAAC,C;;;;;;;;;;;ACAj/B;AACA,OAAO,KAAU,EAAE,kBAKd;;;;;;;;;;;;;;;;ACNL;AAGA;AACA;AAHA;AACAC,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,cAAI,CAAC,C","file":"pages/index/AiTab.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./AiTab.vue?vue&type=template&id=4be7aac7&scoped=true&\"\nvar renderjs\nimport script from \"./AiTab.vue?vue&type=script&lang=js&\"\nexport * from \"./AiTab.vue?vue&type=script&lang=js&\"\nimport style0 from \"./AiTab.vue?vue&type=style&index=0&id=4be7aac7&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4be7aac7\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/index/AiTab.vue\"\nexport default component.exports","export * from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./AiTab.vue?vue&type=template&id=4be7aac7&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.messages.length\n  var l0 = _vm.__map(_vm.messages, function (message, index) {\n    var $orig = _vm.__get_orig(message)\n    var m0 = _vm.formatMessage(message.content)\n    return {\n      $orig: $orig,\n      m0: m0,\n    }\n  })\n  var g1 = !_vm.inputMessage.trim() || _vm.isLoading\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        l0: l0,\n        g1: g1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./AiTab.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./AiTab.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"container\" :class=\"{ 'care-mode': careMode }\">\n    <!-- 导航栏 -->\n    <view class=\"nav-bar\" :style=\"{ paddingTop: statusBarHeight + 'px' }\">\n      <view class=\"nav-left\" @click=\"goBack\">\n        <text class=\"back-icon\">←</text>\n      </view>\n      <text class=\"nav-title\">历小包AI助手</text>\n      <view class=\"nav-right\">\n      </view>\n    </view>\n    \n    <!-- 渐变背景装饰 -->\n    <view class=\"bg-decoration\">\n      <view class=\"circle circle-1\"></view>\n      <view class=\"circle circle-2\"></view>\n      <view class=\"circle circle-3\"></view>\n    </view>\n\t\n    <!-- 聊天界面 -->\n    <view class=\"chat-container\">\n      \n      <!-- 消息列表 -->\n      <scroll-view class=\"message-list\" scroll-y :scroll-top=\"scrollTop\">\n        <!-- 欢迎消息 -->\n        <view class=\"message-item assistant\" v-if=\"messages.length === 0\">\n          <view class=\"message-avatar\">\n            <image class=\"avatar-image\" src=\"https://llzm-lixiaobao.oss-cn-beijing.aliyuncs.com/logo.jpg\" mode=\"aspectFill\" />\n          </view>\n          <view class=\"message-content\">\n            <text class=\"message-text\">你好，有什么我能帮你的吗</text>\n          </view>\n        </view>\n        \n        <!-- 对话消息 -->\n        <view class=\"message-item\" v-for=\"(message, index) in messages\" :key=\"index\" :class=\"message.role\">\n          <view class=\"message-avatar\">\n            <image v-if=\"message.role === 'assistant'\" class=\"avatar-image\" src=\"https://llzm-lixiaobao.oss-cn-beijing.aliyuncs.com/logo.jpg\" mode=\"aspectFill\" />\n            <view v-else class=\"avatar-text\">👤</view>\n          </view>\n          <view class=\"message-content\">\n            <rich-text class=\"message-text\" :nodes=\"formatMessage(message.content)\"></rich-text>\n          </view>\n        </view>\n        \n        <!-- 加载状态 -->\n        <view class=\"message-item assistant\" v-if=\"isLoading\">\n          <view class=\"message-avatar\">\n            <image class=\"avatar-image\" src=\"https://llzm-lixiaobao.oss-cn-beijing.aliyuncs.com/logo.jpg\" mode=\"aspectFill\" />\n          </view>\n          <view class=\"message-content\">\n            <view class=\"typing-indicator\">\n              <view class=\"typing-dot\"></view>\n              <view class=\"typing-dot\"></view>\n              <view class=\"typing-dot\"></view>\n            </view>\n          </view>\n        </view>\n      </scroll-view>\n     \n      <!-- 输入区域 -->\n      <view class=\"input-area\">\n        <view class=\"input-wrapper\">\n          <input \n            class=\"message-input\" \n            v-model=\"inputMessage\" \n            placeholder=\"输入你的问题\"\n            :disabled=\"isLoading\"\n            @confirm=\"sendMessage\"\n          />\n          <button class=\"send-button\" @click=\"sendMessage\" :class=\"{ \n            disabled: !inputMessage.trim() || isLoading,\n            sending: isLoading \n          }\">\n            <text v-if=\"!isLoading\">发送</text>\n            <text v-else>发送中...</text>\n          </button>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 全局悬浮刷新按钮（可拖动） -->\n    <view \n      class=\"global-refresh-btn\" \n      @click=\"handleRefresh\"\n      @touchstart=\"handleTouchStart\"\n      @touchmove=\"handleTouchMove\"\n      @touchend=\"handleTouchEnd\"\n      :style=\"{ \n        left: btnX + 'px', \n        bottom: btnY + 'px' \n      }\"\n    >\n      <image class=\"refresh-icon-img\" src=\"https://llzm-lixiaobao.oss-cn-beijing.aliyuncs.com/%E5%88%B7%E6%96%B0.png\" mode=\"widthFix\"></image>\n    </view>\n  </view>\n</template>\n\n<script>\nimport config from '@/utils/config.js';\nimport careModeMixin from '@/mixins/careMode.js';\n\nexport default {\n  mixins: [careModeMixin],\n  data() {\n    return {\n      statusBarHeight: 0,\n      inputMessage: '',\n      messages: [],\n      isLoading: false,\n      scrollTop: 0,\n      faqList: [\n        {\n          question: '什么是\"洞见历史\"研学项目？',\n          answer: '\"洞见历史\"是一个跨学科项目式学习项目，旨在通过历史文化的深度探索，培养学生的批判性思维和创新能力。'\n        },\n        {\n          question: '教育4.0时代有什么特点？',\n          answer: '教育4.0时代强调个性化学习、跨学科整合、技术融合和终身学习，注重培养学生的创新思维和实践能力。'\n        },\n        {\n          question: '如何参与项目学习？',\n          answer: '您可以通过小程序浏览项目内容，参与在线讨论，提交学习成果，并与团队成员协作完成项目任务。'\n        },\n        {\n          question: '项目有哪些学习资源？',\n          answer: '项目提供丰富的学习资源，包括历史文献、多媒体资料、专家讲座、实践案例等，支持多种学习方式。'\n        }\n      ],\n      // 拖动相关状态\n      btnX: 15,          \n      btnY: 250, \n      startX: 0,         \n      startY: 0,   \n      windowWidth: 375, \n      windowHeight: 667, \n      isDragging: false \n    }\n  },\n  onLoad() {\n    const sys = uni.getSystemInfoSync();\n    this.statusBarHeight = sys.statusBarHeight || 0;\n    this.loadFaqList();\n    \n    // 初始化窗口宽高和按钮位置\n    this.windowWidth = sys.windowWidth;\n    this.windowHeight = sys.windowHeight;\n    this.btnX = 30 / 2; // 转换rpx为px\n    this.btnY = 500 / 2;\n  },\n  methods: {\n    // 格式化消息内容，处理Markdown\n    formatMessage(content) {\n      if (!content) return '';\n      \n      // 清理和格式化内容\n      let formatted = content\n        // 处理标题 - 移除#符号并转换为样式\n        .replace(/^#{1,6}\\s+(.*)$/gm, (match, title) => {\n          const level = match.match(/^#+/)[0].length;\n          const fontSize = Math.max(28, 40 - level * 4);\n          return `<div style=\"font-size: ${fontSize}rpx; font-weight: bold; margin: 20rpx 0 10rpx 0; color: #333; line-height: 1.4;\">${title}</div>`;\n        })\n        // 处理粗体\n        .replace(/\\*\\*(.*?)\\*\\*/g, '<span style=\"font-weight: bold;\">$1</span>')\n        // 处理斜体\n        .replace(/\\*(.*?)\\*/g, '<span style=\"font-style: italic;\">$1</span>')\n        // 处理列表项\n        .replace(/^[\\s]*[-*+]\\s+(.*)$/gm, '<div style=\"margin: 8rpx 0; padding-left: 20rpx; position: relative;\"><span style=\"position: absolute; left: 0; color: #666;\">•</span>$1</div>')\n        // 处理数字列表\n        .replace(/^[\\s]*(\\d+)\\.\\s+(.*)$/gm, '<div style=\"margin: 8rpx 0; padding-left: 20rpx; position: relative;\"><span style=\"position: absolute; left: 0; color: #666;\">$1.</span>$2</div>')\n        // 处理换行\n        .replace(/\\n/g, '<br/>')\n        // 清理多余的#符号\n        .replace(/#{2,}/g, '')\n        // 清理行首的#符号\n        .replace(/^#+\\s*/gm, '');\n      \n      return formatted;\n    },\n    \n    // 原始返回逻辑保持不变\n    goBack() {\n      console.log('返回按钮被点击');\n      uni.showToast({\n        title: '返回按钮被点击',\n        icon: 'none',\n        duration: 1000\n      });\n      \n      try {\n        // 先尝试返回上一页\n        const pages = getCurrentPages();\n        console.log('当前页面栈长度:', pages.length);\n        console.log('当前页面:', pages[pages.length - 1].route);\n        \n        if (pages.length > 1) {\n          console.log('尝试返回上一页');\n          uni.navigateBack({\n            delta: 1,\n            animationType: 'slide-out-right',\n            animationDuration: 300,\n            success: () => {\n              console.log('返回成功');\n            },\n            fail: (err) => {\n              console.error('返回失败:', err);\n              // 备用方案：跳转到首页\n              uni.switchTab({\n                url: '/pages/index/index'\n              });\n            }\n          });\n        } else {\n          console.log('没有上一页，跳转到首页');\n          // 如果没有上一页，跳转到首页\n          uni.switchTab({\n            url: '/pages/index/index',\n            success: () => {\n              console.log('跳转首页成功');\n            },\n            fail: (err) => {\n              console.error('跳转首页失败:', err);\n            }\n          });\n        }\n      } catch (error) {\n        console.error('返回失败:', error);\n        // 备用方案：跳转到首页\n        uni.switchTab({\n          url: '/pages/index/index'\n        });\n      }\n    },\n    \n    // 清空对话\n    clearChat() {\n      uni.showModal({\n        title: '确认清空',\n        content: '确定要清空所有对话记录吗？',\n        success: (res) => {\n          if (res.confirm) {\n            this.messages = [];\n            this.scrollToBottom();\n          }\n        }\n      });\n    },\n    \n    // 发送消息\n    async sendMessage() {\n      if (!this.inputMessage.trim() || this.isLoading) return;\n      \n      const userMessage = this.inputMessage.trim();\n      this.inputMessage = '';\n      \n      // 添加用户消息\n      this.messages.push({\n        role: 'user',\n        content: userMessage,\n        timestamp: new Date()\n      });\n      \n      this.scrollToBottom();\n      this.isLoading = true;\n      \n      try {\n        // 构建对话历史\n        const conversationHistory = this.messages\n          .filter(msg => msg.role !== 'system')\n          .map(msg => ({\n            role: msg.role,\n            content: msg.content\n          }));\n        \n        // 调用AI API\n        const response = await uni.request({\n          url: `https://llzmlxb.xyz/api/ai/ask`,\n          method: 'POST',\n          data: {\n            question: userMessage,\n            conversationHistory: conversationHistory\n          },\n          timeout: 30000\n        });\n        \n        if (response.data && response.data.success) {\n          // 添加AI回复\n          this.messages.push({\n            role: 'assistant',\n            content: response.data.data.answer,\n            timestamp: new Date()\n          });\n        } else {\n          throw new Error(response.data?.error || 'AI服务暂时不可用');\n        }\n        \n      } catch (error) {\n        console.error('AI问答失败:', error);\n        this.messages.push({\n          role: 'assistant',\n          content: '抱歉，AI服务暂时不可用，请稍后再试。',\n          timestamp: new Date()\n        });\n      } finally {\n        this.isLoading = false;\n        this.scrollToBottom();\n      }\n    },\n    \n    // 点击常见问题\n    askQuestion(question) {\n      this.inputMessage = question;\n      this.sendMessage();\n    },\n    \n    // 加载常见问题列表\n    async loadFaqList() {\n      try {\n        const response = await uni.request({\n          url: `http://8.137.115.16:3000/api/ai/faq`,\n          method: 'GET'\n        });\n        \n        if (response.data && response.data.success) {\n          this.faqList = response.data.data;\n        }\n      } catch (error) {\n        console.error('加载常见问题失败:', error);\n      }\n    },\n    \n    // 滚动到底部\n    scrollToBottom() {\n      this.$nextTick(() => {\n        this.scrollTop = 99999;\n      });\n    },\n    \n    // 格式化时间\n    formatTime(timestamp) {\n      const date = new Date(timestamp);\n      const now = new Date();\n      const diff = now - date;\n      \n      if (diff < 60000) { // 1分钟内\n        return '刚刚';\n      } else if (diff < 3600000) { // 1小时内\n        return Math.floor(diff / 60000) + '分钟前';\n      } else if (diff < 86400000) { // 1天内\n        return Math.floor(diff / 3600000) + '小时前';\n      } else {\n        return date.toLocaleDateString();\n      }\n    },\n    \n    // 全局刷新按钮逻辑\n    async handleRefresh() {\n      // 如果处于拖动状态，不执行刷新（避免误触）\n      if (this.isDragging) return;\n\n      // 显示加载提示\n      uni.showLoading({\n        title: '刷新中...',\n        mask: true\n      });\n      \n      try {\n        // 1. 清空现有对话\n        this.messages = [];\n        // 2. 重新加载FAQ列表\n        await this.loadFaqList();\n        // 3. 滚动到底部\n        this.scrollToBottom();\n      } catch (error) {\n        console.error('刷新失败:', error);\n        uni.showToast({\n          title: '刷新失败，请重试',\n          icon: 'none',\n          duration: 1500\n        });\n      } finally {\n        // 隐藏加载提示\n        uni.hideLoading();\n      }\n    },\n    \n    // 触摸开始：记录初始位置\n    handleTouchStart(e) {\n      const touch = e.touches[0];\n      this.startX = touch.clientX;\n      this.startY = touch.clientY;\n      this.isDragging = false;\n    },\n    \n    // 触摸移动：更新按钮位置\n    handleTouchMove(e) {\n      const touch = e.touches[0];\n      const currentX = touch.clientX;\n      const currentY = touch.clientY;\n\n      // 计算偏移量\n      const deltaX = currentX - this.startX;\n      const deltaY = currentY - this.startY;\n\n      // 判断是否触发拖动（偏移量超过5px视为拖动）\n      if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n        this.isDragging = true;\n\n        // 计算新位置\n        let newBtnX = this.btnX + deltaX;\n        let newBtnY = this.btnY - deltaY; // Y轴反向\n\n        // 按钮尺寸（rpx转换为px）\n        const btnWidth = this.careMode ? 110 / 2 : 80 / 2;\n        const btnHeight = this.careMode ? 110 / 2 : 80 / 2;\n        \n        // 限制边界\n        newBtnX = Math.max(10, Math.min(newBtnX, this.windowWidth - btnWidth - 10));\n        newBtnY = Math.max(10, Math.min(newBtnY, this.windowHeight - btnHeight - 10));\n\n        // 更新位置\n        this.btnX = newBtnX;\n        this.btnY = newBtnY;\n\n        // 更新起始位置\n        this.startX = currentX;\n        this.startY = currentY;\n      }\n    },\n    \n    // 触摸结束：添加边缘吸附效果\n    handleTouchEnd() {\n      // 边缘吸附效果\n      const halfWidth = this.windowWidth / 2;\n      const btnWidth = this.careMode ? 110 / 2 : 80 / 2;\n      \n      if (this.btnX > halfWidth) {\n        // 吸附到右侧\n        this.btnX = this.windowWidth - btnWidth - 10;\n      } else {\n        // 吸附到左侧\n        this.btnX = 10;\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* 基础容器 */\n.container {\n  min-height: 100vh;\n  background: #fff;\n  position: relative;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n}\n\n/* 导航栏 */\n.nav-bar {\n  position: fixed; /* 固定定位 */\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 999; /* 确保在最上层 */\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20rpx 30rpx;\n  background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);\n  color: #333;\n  min-height: 120rpx;\n  box-sizing: border-box;\n}\n\n.nav-left, .nav-right {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 60rpx;\n  height: 60rpx;\n  border-radius: 50%;\n  background: rgba(255, 255, 255, 0.2);\n  backdrop-filter: blur(10rpx);\n  margin-right: 20rpx;\n}\n\n.back-icon {\n  font-size: 36rpx;\n  color: #ffffff;\n  font-weight: bold;\n  padding: 20rpx;\n  border-radius: 8rpx;\n  transition: background-color 0.2s ease;\n  display: block;\n  text-align: center;\n  line-height: 1;\n}\n\n.nav-left:active .back-icon {\n  background-color: rgba(0, 0, 0, 0.1);\n}\n\n.nav-title {\n  font-size: 45rpx;\n  color: #ffffff;\n  font-weight: bold;\n  text-align: center;\n  flex: 1;\n  line-height: 1.2;\n  padding: 0 20rpx;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.nav-icon {\n  font-size: 32rpx;\n  color: #333;\n  font-weight: bold;\n}\n\n/* 背景装饰 */\n.bg-decoration {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n  z-index: 1;\n}\n\n.circle {\n  position: fixed; /* 固定定位 */\n  border-radius: 50%;\n  background: rgba(17, 68, 255, 0.1);\n  animation: float 6s ease-in-out infinite;\n}\n\n.circle-1 {\n  width: 200rpx;\n  height: 200rpx;\n  top: 20%;\n  left: 10%;\n  animation-delay: 0s;\n}\n\n.circle-2 {\n  width: 350rpx;\n  height: 350rpx;\n  top: 40%;\n  right: 5%;\n  animation-delay: 2s;\n}\n\n.circle-3 {\n  width: 100rpx;\n  height: 100rpx;\n  bottom: 20%;\n  left: 20%;\n  animation-delay: 4s;\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0px) rotate(0deg); }\n  50% { transform: translateY(-20px) rotate(180deg); }\n}\n\n\n/* 聊天容器 */\n.chat-container {\n  position: relative;\n  z-index: 2;\n  display: flex;\n  flex-direction: column;\n  padding: 0;\n  box-sizing: border-box;\r\n  /* 导航栏高度约120rpx + 状态栏高度） */\r\n    padding-top: calc(var(--status-bar-height, 0rpx) + 120rpx);\r\n/*高度为全屏减去导航栏，确保底部与输入框衔接 */\r\n    height: 100vh;\n}\n\n@keyframes pulse {\n  0% {\n    transform: scale(1);\n    box-shadow: 0 4rpx 12rpx rgba(255, 107, 139, 0.3);\n  }\n  50% {\n    transform: scale(1.02);\n    box-shadow: 0 6rpx 16rpx rgba(255, 107, 139, 0.4);\n  }\n  100% {\n    transform: scale(1);\n    box-shadow: 0 4rpx 12rpx rgba(255, 107, 139, 0.3);\n  }\n}\n\n\n/* 消息列表 */\n.message-list {\n  flex: 1;\n  padding: 20rpx 20rpx 150rpx; \n  display: flex;\n  flex-direction: column;\n  gap: 30rpx;\n  box-sizing: border-box;\n  overflow-x: hidden;\n}\n\n/* 消息项 */\n.message-item {\n  display: flex;\n  gap: 20rpx;\n  align-items: flex-start;\n  margin-bottom: 40rpx;\n  animation: slideIn 0.3s ease-out;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.message-item.user {\n  flex-direction: row-reverse;\n}\n\n@keyframes slideIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* 头像 背景*/\n.message-avatar {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\n}\n\n.message-item.user .message-avatar {\n  background: #ffffff;\n}\n\n.message-item.assistant .message-avatar {\n  background: #ffaaff;\n}\n/* 渐变用户头像 */\n.avatar-text {\n    font-size: 45rpx;\n    font-weight: bold;\n    background: linear-gradient(135deg, #aaaaff, #fecfef);\n    -webkit-background-clip: text;\n    background-clip: text;\n    color: transparent;\n    /* 兼容微信小程序 */\n    display: inline-block;\n}\n\n.avatar-image {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n\n/* AI消息内容 */\n.message-item.assistant .message-content {\n  background: #f0f8ff;\n  color: #333;\n  border-bottom-left-radius: 6rpx;\n}\n.message-content {\n  max-width: calc(100% - 240rpx);\n  padding: 20rpx 24rpx;\n  border-radius: 20rpx;\n  position: relative;\n  line-height: 1.6;\n  word-wrap: break-word;\n  word-break: break-word;\n  overflow-wrap: break-word;\n  opacity: 0.8;\n}\n/* 用户消息内容 */\n.message-item.user .message-content {\n    background:#ffd8ff;\n    color: #333; /* 文本颜色 */\n    border-bottom-right-radius: 6rpx; /* 右下角圆角 */\n    max-width: calc(100% - 240rpx); /* 最大宽度（默认与AI消息一致） */\n    padding: 20rpx 24rpx; /* 内边距 */\n    line-height: 1.6; /* 行高 */\n\topacity: 0.8;\n}\n\n/* 整体文字文本 */\n.message-text {\n  font-size: 28rpx;\n  line-height: 1.6;\n  display: block;\n  width: 100%;\n  word-wrap: break-word;\n  word-break: break-word;\n  overflow-wrap: break-word;\n}\n\n/* rich-text样式 */\n.message-text h1,\n.message-text h2,\n.message-text h3,\n.message-text h4,\n.message-text h5,\n.message-text h6 {\n  margin: 0;\n  padding: 0;\n  font-weight: bold;\n  line-height: 1.4;\n}\n\n.message-text strong {\n  font-weight: bold;\n}\n\n.message-text em {\n  font-style: italic;\n}\n\n.message-text div {\n  margin: 8rpx 0;\n  line-height: 1.6;\n}\n\n.message-text span {\n  display: inline;\n}\n\n/* 输入区域 */\n.input-area {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 20rpx;\n  background: #fff;\n  border-radius: 24rpx 24rpx 0 0;\n  box-shadow: 0 -4rpx 20rpx rgba(0, 0, 0, 0.1);\n  z-index: 10;\n}\n\n.input-wrapper {\n  display: flex;\n  gap: 16rpx;\n  align-items: center;\n  background: #f5f5f5;\n  border-radius: 25rpx;\n  padding: 8rpx;\n}\n\n.message-input {\n  flex: 1;\n  height: 80rpx;\n  background: transparent;\n  border: none;\n  padding: 0 24rpx;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.message-input:focus {\n  outline: none;\n}\n\n.send-button {\n  height: 80rpx;\n  padding: 0 24rpx;\n  background: linear-gradient(135deg, #ff6b8b, #ff8e8e);\n  color: #fff;\n  border-radius: 20rpx;\n  font-size: 28rpx;\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s ease;\n  box-shadow: 0 4rpx 12rpx rgba(255, 107, 139, 0.3);\n  font-weight: 500;\n}\n\n.send-button::after {\n  border: none;\n}\n\n/* 正常状态 - 有内容且未发送 */\n.send-button:not(.disabled):not(.sending) {\n  background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);\n  box-shadow: 0 4rpx 12rpx rgba(227, 222, 255, 0.3);\n  opacity: 1;\n}\n\n/* 发送中状态 */\n.send-button.sending {\n  background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);\n  box-shadow: 0 4rpx 12rpx rgba(255, 167, 38, 0.3);\n  opacity: 0.8;\n  animation: pulse 1.5s ease-in-out infinite;\n}\n\n/* 禁用状态 - 无内容或发送中 */\n.send-button.disabled {\n  background: #e0e0e0;\n  color: #999;\n  box-shadow: none;\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.send-button:active:not(.disabled) {\n  transform: scale(0.95);\n}\n\n/* 发送中动画 */\n@keyframes pulse {\n  0% {\n    opacity: 0.8;\n    transform: scale(1);\n  }\n  50% {\n    opacity: 1;\n    transform: scale(1.02);\n  }\n  100% {\n  opacity: 0.8;\n    transform: scale(1);\n  }\n}\n\n/* 打字指示器 */\n.typing-indicator {\n  display: flex;\n  gap: 8rpx;\n  align-items: center;\n}\n\n.typing-dot {\n  width: 12rpx;\n  height: 12rpx;\n  background: #999;\n  border-radius: 50%;\n  animation: typing 1.4s infinite ease-in-out;\n}\n\n.typing-dot:nth-child(1) { animation-delay: -0.32s; }\n.typing-dot:nth-child(2) { animation-delay: -0.16s; }\n\n@keyframes typing {\n  0%, 80%, 100% { \n    transform: scale(0.8); \n    opacity: 0.5; \n  }\n  40% { \n    transform: scale(1); \n    opacity: 1; \n  }\n}\n\n/* 响应式调整 */\n@media (max-width: 375px) {\n  .chat-container {\n    padding: 15rpx;\n  }\n  \n  .message-list {\n    padding: 30rpx 15rpx;\n  }\n  \n  .input-area {\n    padding: 15rpx;\n  }\n}\n\n/* 关怀模式下的AI标识 */\n.container.care-mode .ai-label-text {\n  font-size: 34rpx;\n}\n\n.container.care-mode .ai-label {\n  padding: 16rpx 32rpx;\n  margin: 24rpx 30rpx;\n}\n\n/* 全局悬浮刷新按钮 */\n.global-refresh-btn {\n  position: fixed;\n  z-index: 9999;\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 50%;\n  background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);\n  opacity: 0.8;\n  box-shadow: 0 6rpx 16rpx rgba(113, 113, 113, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s ease;\n  touch-action: none; /* 优化拖动体验 */\n}\n\n.global-refresh-btn .refresh-icon-img {\n  width: 60rpx;\n  height: 60rpx;\n  object-fit: contain;\n  opacity: 0.9;\n  transition: opacity 0.3s ease;\n  filter: drop-shadow(0 0 0 #ffffff);\n}\n\n.global-refresh-btn:hover {\n  transform: scale(1.1);\n  box-shadow: 0 8rpx 20rpx rgba(255, 167, 190, 0.6);\n}\n\n.global-refresh-btn:hover .refresh-icon-img {\n  opacity: 1;\n}\n\n.global-refresh-btn:active {\n  transform: scale(0.95);\n  box-shadow: 0 4rpx 12rpx rgba(255, 167, 190, 0.3);\n}\n\n/* 关怀模式适配 */\n.container.care-mode .global-refresh-btn {\n  width: 110rpx;\n  height: 110rpx;\n}\n.container.care-mode .global-refresh-btn .refresh-icon-img {\n  width: 50rpx;\n  height: 50rpx;\n}\n\n</style>\n    ","import mod from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./AiTab.vue?vue&type=style&index=0&id=4be7aac7&scoped=true&lang=css&\"; export default mod; export * from \"-!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Hbuilder X\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./AiTab.vue?vue&type=style&index=0&id=4be7aac7&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1759132807209\n      var cssReload = require(\"D:/Hbuilder X/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/index/AiTab.vue'\ncreatePage(Page)"],"sourceRoot":""}