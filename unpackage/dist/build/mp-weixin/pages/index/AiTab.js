(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/AiTab"],{"15d2":function(e,t,n){"use strict";(function(e,t){var a=n("47a9");n("f68b");a(n("3240"));var s=a(n("1ff1"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"1ff1":function(e,t,n){"use strict";n.r(t);var a=n("6fe3"),s=n("7bd0");for(var o in s)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(o);n("9565");var r=n("828b"),i=Object(r["a"])(s["default"],a["b"],a["c"],!1,null,"30b2aaaf",null,!1,a["a"],void 0);t["default"]=i.exports},"6fe3":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.messages.length),a=e.__map(e.messages,(function(t,n){var a=e.__get_orig(t),s=e.formatMessage(t.content);return{$orig:a,m0:s}})),s=!e.inputMessage.trim()||e.isLoading;e.$mp.data=Object.assign({},{$root:{g0:n,l0:a,g1:s}})},s=[]},"7bd0":function(e,t,n){"use strict";n.r(t);var a=n("84e1"),s=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=s.a},"84e1":function(e,t,n){"use strict";(function(e){var a=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(n("7eb4")),o=a(n("ee10")),r=(a(n("baa8")),a(n("f24a"))),i={mixins:[r.default],data:function(){return{statusBarHeight:0,inputMessage:"",messages:[],isLoading:!1,scrollTop:0,faqList:[{question:'什么是"洞见历史"研学项目？',answer:'"洞见历史"是一个跨学科项目式学习项目，旨在通过历史文化的深度探索，培养学生的批判性思维和创新能力。'},{question:"教育4.0时代有什么特点？",answer:"教育4.0时代强调个性化学习、跨学科整合、技术融合和终身学习，注重培养学生的创新思维和实践能力。"},{question:"如何参与项目学习？",answer:"您可以通过小程序浏览项目内容，参与在线讨论，提交学习成果，并与团队成员协作完成项目任务。"},{question:"项目有哪些学习资源？",answer:"项目提供丰富的学习资源，包括历史文献、多媒体资料、专家讲座、实践案例等，支持多种学习方式。"}]}},onLoad:function(){var t=e.getSystemInfoSync();this.statusBarHeight=t.statusBarHeight||0,this.loadFaqList()},methods:{formatMessage:function(e){if(!e)return"";var t=e.replace(/^#{1,6}\s+(.*)$/gm,(function(e,t){var n=e.match(/^#+/)[0].length,a=Math.max(28,40-4*n);return'<div style="font-size: '.concat(a,'rpx; font-weight: bold; margin: 20rpx 0 10rpx 0; color: #333; line-height: 1.4;">').concat(t,"</div>")})).replace(/\*\*(.*?)\*\*/g,'<span style="font-weight: bold;">$1</span>').replace(/\*(.*?)\*/g,'<span style="font-style: italic;">$1</span>').replace(/^[\s]*[-*+]\s+(.*)$/gm,'<div style="margin: 8rpx 0; padding-left: 20rpx; position: relative;"><span style="position: absolute; left: 0; color: #666;">•</span>$1</div>').replace(/^[\s]*(\d+)\.\s+(.*)$/gm,'<div style="margin: 8rpx 0; padding-left: 20rpx; position: relative;"><span style="position: absolute; left: 0; color: #666;">$1.</span>$2</div>').replace(/\n/g,"<br/>").replace(/#{2,}/g,"").replace(/^#+\s*/gm,"");return t},goBack:function(){console.log("返回按钮被点击"),e.showToast({title:"返回按钮被点击",icon:"none",duration:1e3});try{var t=getCurrentPages();console.log("当前页面栈长度:",t.length),console.log("当前页面:",t[t.length-1].route),t.length>1?(console.log("尝试返回上一页"),e.navigateBack({delta:1,animationType:"slide-out-right",animationDuration:300,success:function(){console.log("返回成功")},fail:function(t){console.error("返回失败:",t),e.switchTab({url:"/pages/index/index"})}})):(console.log("没有上一页，跳转到首页"),e.switchTab({url:"/pages/index/index",success:function(){console.log("跳转首页成功")},fail:function(e){console.error("跳转首页失败:",e)}}))}catch(n){console.error("返回失败:",n),e.switchTab({url:"/pages/index/index"})}},clearChat:function(){var t=this;e.showModal({title:"确认清空",content:"确定要清空所有对话记录吗？",success:function(e){e.confirm&&(t.messages=[],t.scrollToBottom())}})},sendMessage:function(){var t=this;return(0,o.default)(s.default.mark((function n(){var a,o,r,i;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.inputMessage.trim()&&!t.isLoading){n.next=2;break}return n.abrupt("return");case 2:return a=t.inputMessage.trim(),t.inputMessage="",t.messages.push({role:"user",content:a,timestamp:new Date}),t.scrollToBottom(),t.isLoading=!0,n.prev=7,o=t.messages.filter((function(e){return"system"!==e.role})).map((function(e){return{role:e.role,content:e.content}})),n.next=11,e.request({url:"https://llzmlxb.xyz/api/ai/ask",method:"POST",data:{question:a,conversationHistory:o},timeout:3e4});case 11:if(r=n.sent,!r.data||!r.data.success){n.next=16;break}t.messages.push({role:"assistant",content:r.data.data.answer,timestamp:new Date}),n.next=17;break;case 16:throw new Error((null===(i=r.data)||void 0===i?void 0:i.error)||"AI服务暂时不可用");case 17:n.next=23;break;case 19:n.prev=19,n.t0=n["catch"](7),console.error("AI问答失败:",n.t0),t.messages.push({role:"assistant",content:"抱歉，AI服务暂时不可用，请稍后再试。",timestamp:new Date});case 23:return n.prev=23,t.isLoading=!1,t.scrollToBottom(),n.finish(23);case 27:case"end":return n.stop()}}),n,null,[[7,19,23,27]])})))()},askQuestion:function(e){this.inputMessage=e,this.sendMessage()},loadFaqList:function(){var t=this;return(0,o.default)(s.default.mark((function n(){var a;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.request({url:"http://8.137.115.16:3000/api/ai/faq",method:"GET"});case 3:a=n.sent,a.data&&a.data.success&&(t.faqList=a.data.data),n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](0),console.error("加载常见问题失败:",n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},scrollToBottom:function(){var e=this;this.$nextTick((function(){e.scrollTop=99999}))},formatTime:function(e){var t=new Date(e),n=new Date,a=n-t;return a<6e4?"刚刚":a<36e5?Math.floor(a/6e4)+"分钟前":a<864e5?Math.floor(a/36e5)+"小时前":t.toLocaleDateString()}}};t.default=i}).call(this,n("df3c")["default"])},9565:function(e,t,n){"use strict";var a=n("e814"),s=n.n(a);s.a},e814:function(e,t,n){}},[["15d2","common/runtime","common/vendor"]]]);