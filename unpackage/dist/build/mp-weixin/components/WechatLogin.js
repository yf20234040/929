(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/WechatLogin"],{"2be2":function(e,t,n){"use strict";n.r(t);var r=n("32cd"),a=n("2f02");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("d27b");var c=n("828b"),s=Object(c["a"])(a["default"],r["b"],r["c"],!1,null,"86cb5aa2",null,!1,r["a"],void 0);t["default"]=s.exports},"2f02":function(e,t,n){"use strict";n.r(t);var r=n("8c17"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"32cd":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var r=function(){var e=this.$createElement;this._self._c},a=[]},"8c17":function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),o=r(n("ee10")),c={name:"WechatLogin",data:function(){return{loading:!1}},methods:{handleGetPhoneNumber:function(t){var n=this;return(0,o.default)(a.default.mark((function r(){var o,c,s;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.loading){r.next=2;break}return r.abrupt("return");case 2:if(n.loading=!0,r.prev=3,"getPhoneNumber:ok"===t.detail.errMsg){r.next=7;break}return e.showToast({title:"获取手机号失败，请重试",icon:"none"}),r.abrupt("return");case 7:if(t.detail.code){r.next=10;break}return e.showToast({title:"获取手机号失败，请重试",icon:"none"}),r.abrupt("return");case 10:return e.showLoading({title:"登录中...",mask:!0}),r.prev=11,r.next=14,n.getPhoneNumberFromServer(t.detail.code);case 14:if(o=r.sent,o.success){r.next=17;break}throw new Error(o.message||"获取手机号失败");case 17:c={nickName:o.phoneNumber||"访客用户",phone:o.phoneNumber,avatarUrl:"",loginType:"wechatPhone",timestamp:Date.now()},n.saveLoginInfo(c,t.detail.code),e.hideLoading(),e.showToast({title:"登录成功",icon:"success",duration:1500}),n.$emit("login-success",c),n.navigateToProfile(),r.next=34;break;case 25:r.prev=25,r.t0=r["catch"](11),console.error("API登录失败，尝试备用方案:",r.t0),s={nickName:"访客用户",phone:"",avatarUrl:"",loginType:"guest",timestamp:Date.now()},n.saveLoginInfo(s,t.detail.code),e.hideLoading(),e.showToast({title:"登录成功（访客模式）",icon:"success",duration:2e3}),n.$emit("login-success",s),n.navigateToProfile();case 34:r.next=41;break;case 36:r.prev=36,r.t1=r["catch"](3),e.hideLoading(),e.showToast({title:r.t1.message||"登录失败，请重试",icon:"none"}),n.$emit("login-error",r.t1);case 41:return r.prev=41,n.loading=!1,r.finish(41);case 44:case"end":return r.stop()}}),r,null,[[3,36,41,44],[11,25]])})))()},getPhoneNumberFromServer:function(e){var t=this;return(0,o.default)(a.default.mark((function n(){var r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.callBackendAPI(e);case 3:if(r=n.sent,!r.success){n.next=8;break}return n.abrupt("return",{success:!0,phoneNumber:r.phoneNumber,message:"获取手机号成功"});case 8:throw new Error(r.message||"获取手机号失败");case 9:n.next=15;break;case 11:throw n.prev=11,n.t0=n["catch"](0),console.error("获取手机号失败:",n.t0),new Error("网络请求失败");case 15:case"end":return n.stop()}}),n,null,[[0,11]])})))()},callBackendAPI:function(t){return(0,o.default)(a.default.mark((function n(){var r,o,c,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,console.log("开始调用登录API，code:",t),n.next=4,e.request({url:"https://llzmlxb.xyz/api/auth/get-phone-number",method:"POST",data:{code:t},header:{"Content-Type":"application/json"},timeout:1e4});case 4:if(r=n.sent,console.log("API响应:",r),console.log("API响应数据:",r.data),!r||200!==r.statusCode){n.next=17;break}if(!r.data||0!==r.data.code){n.next=12;break}return n.abrupt("return",{success:!0,phoneNumber:r.data.data.userInfo.phoneNumber,message:r.data.message});case 12:throw c=(null===(o=r.data)||void 0===o?void 0:o.message)||"获取手机号失败",console.error("API返回错误:",c,r),new Error(c);case 15:n.next=20;break;case 17:throw s=(null===r||void 0===r?void 0:r.errMsg)||"网络请求失败",console.error("API请求失败:",s,r),new Error(s);case 20:n.next=32;break;case 22:if(n.prev=22,n.t0=n["catch"](0),console.error("API调用失败:",n.t0),!n.t0.errMsg||!n.t0.errMsg.includes("timeout")){n.next=29;break}throw new Error("网络超时，请检查网络连接");case 29:if(!n.t0.errMsg||!n.t0.errMsg.includes("fail")){n.next=31;break}throw new Error("网络请求失败，请检查网络连接");case 31:throw n.t0;case 32:case"end":return n.stop()}}),n,null,[[0,22]])})))()},saveLoginInfo:function(t,n){try{e.removeStorageSync("userInfo"),e.removeStorageSync("wechatPhoneCode"),e.removeStorageSync("loginType"),e.removeStorageSync("isLoggedIn"),e.setStorageSync("userInfo",t),e.setStorageSync("wechatPhoneCode",n),e.setStorageSync("loginType","wechatPhone"),e.setStorageSync("isLoggedIn",!0)}catch(r){console.error("保存登录信息失败:",r)}},navigateToProfile:function(){setTimeout((function(){e.reLaunch({url:"/pages/index/index?tab=4"})}),1500)}}};t.default=c}).call(this,n("df3c")["default"])},a0b7:function(e,t,n){},d27b:function(e,t,n){"use strict";var r=n("a0b7"),a=n.n(r);a.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/WechatLogin-create-component',
    {
        'components/WechatLogin-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('df3c')['createComponent'](__webpack_require__("2be2"))
        })
    },
    [['components/WechatLogin-create-component']]
]);
